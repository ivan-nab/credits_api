# API для формирования и исполнения заявок в кредитные организации
[![Codeship Status for ivan-nab/credits_api](https://app.codeship.com/projects/4ff62410-81c1-0138-f323-7e65aa17defc/status?branch=master)](https://app.codeship.com/projects/397904)
## Стек технологий

- Django 3.0
- djangorestframework 3.11
- PostgreSQL 12
- docker
## Установка

1. Склонировать репозиторий

```
git clone https://github.com/ivan-nab/credits_api.git
```
2. Запустить контейнеры

```
cd credits_api
docker-compose up
```
По умолчанию загружаются данные initial_data

Логин и пароль администратора:
| Логин | Пароль |
|-------|--------|
|admin|1|

У всех пользователей пароль по усмолчанию - ```1```
## Функционал API

API разделено на два интерфейса

1. API для подключение партнеров, через которое партнер может выполнять действия с анкетами, доступное по url 
   ```/partners-api/v1/```


- получение списка анкет (с сортировкой и фильтрами)

```
GET /partners-api/v1/creditforms/
```
- получение списка подходящих предложений
```
GET /partners-api/v1/creditforms/<id>/relevant-offers
```
- просмотр анкеты по id
  
```
GET /partners-api/v1/creditforms/<id>
```

- создание анкеты
```
POST /partners-api/v1/creditforms/
```
- отправка заявки в кредитные организации (во все или по выбору)
```
POST /partners-api/v1/creditforms/<id>/send-to-banks
```
Параметры запроса:
```
{
    "credit_offers: [<id>] #список идентификаторов предложений
}
```
При отправке пустого POST запроса будут сформированы заявки по всем имеющимся кредитным предложениям


2. API для кредитных организаций, доступное по url 
   ```/banks-api/v1/``` через которое можно выполнить:
- получение списка заявок (с сортировкой и фильтрами)
```
GET /banks-api/v1/requests/
```
- просмотре заявки по id
```
GET /banks-api/v1/requests/<id>
```
- смена статуса заявки
  
```
POST /banks-api/v1/request/<id>/set-status/
```
Параметры запроса:

```
{
    "status" : "approved" 
}
```
Допустимые значения статуса - approved, denied, issued

## Роли в системе

### Суперпользователи:​
Суперпользователем системы является любой пользователь, у которого в профиле установлен флаг is_staff

### Партнеры:​
Партнеры относятся к группе пользователей "partners".
Все пользователи, относящиеся к группе "partners":
- имеют доступ только к ​partners-api
- могут создавать анкеты и отправлять заявки
- могут видеть только свои заявки и анкеты (которые сами создали)
- не могут удалять и редактировать анкеты и заявки

### Кредитные организации:​
Кредитные организации относятся к группе "banks".
Все пользователи, относящиеся к группе "banks"

- имеют доступ к banks-api
- могут видеть заявки, которые отправлены к ним
- не могут удалять и редактировать ничего
- могут изменить в заявке статус

### Документация
Документация в формате OpenAPI/Swagger 
доступна по url/swagger